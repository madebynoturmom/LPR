{"version":3,"file":"19-DUKN58v4.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/login/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/19.js"],"sourcesContent":["import { d as db, b as admin, u as user } from \"../../../chunks/index3.js\";\nimport { fail, redirect } from \"@sveltejs/kit\";\nimport { sha256 } from \"@oslojs/crypto/sha2\";\nimport { encodeHexLowerCase } from \"@oslojs/encoding\";\nimport { eq } from \"drizzle-orm\";\nimport { g as generateSessionToken, c as createSession, s as setSessionTokenCookie } from \"../../../chunks/auth.js\";\nconst actions = {\n  default: async (event) => {\n    const { request, cookies } = event;\n    const form = await request.formData();\n    const username = form.get(\"username\")?.toString().trim();\n    const password = form.get(\"password\")?.toString();\n    if (!username || !password) {\n      console.error(\"Login failed: Missing username or password\");\n      return fail(400, { error: \"Username and password are required.\" });\n    }\n    let found = null;\n    let userRole = null;\n    const admins = await db.select().from(admin).where(eq(admin.username, username));\n    if (admins.length > 0) {\n      found = admins[0];\n      userRole = \"admin\";\n    } else {\n      const users = await db.select().from(user).where(eq(user.username, username));\n      if (users.length > 0) {\n        found = users[0];\n        userRole = found.role;\n      }\n    }\n    if (!found) {\n      console.error(\"Login failed: Invalid username\");\n      return fail(401, { error: \"Invalid username or password.\" });\n    }\n    const hash = encodeHexLowerCase(sha256(new TextEncoder().encode(password)));\n    if (hash !== found.passwordHash) {\n      console.error(\"Login failed: Invalid password\");\n      return fail(401, { error: \"Invalid username or password.\" });\n    }\n    const sessionToken = generateSessionToken();\n    const session = await createSession(sessionToken, found.id);\n    setSessionTokenCookie(event, sessionToken, session.expiresAt);\n    if (userRole === \"admin\") {\n      throw redirect(303, \"/admin/dashboard\");\n    } else if (userRole === \"guard\") {\n      throw redirect(303, \"/guard/dashboard\");\n    } else if (userRole === \"resident\") {\n      throw redirect(303, \"/user/dashboard\");\n    } else {\n      throw redirect(303, \"/\");\n    }\n  }\n};\nconst load = async () => {\n  return {};\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/login/_page.server.ts.js';\n\nexport const index = 19;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/login/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/login/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/19.N81U_yW0.js\",\"_app/immutable/chunks/DsnmJJEf.js\",\"_app/immutable/chunks/CYPRAMuI.js\",\"_app/immutable/chunks/VJxR2mP4.js\",\"_app/immutable/chunks/tQRZQKdW.js\",\"_app/immutable/chunks/CFpdNlsL.js\",\"_app/immutable/chunks/CBdOqptF.js\"];\nexport const stylesheets = [\"_app/immutable/assets/19.NJqmu5VW.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}