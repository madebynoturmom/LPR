{"version":3,"file":"11-CZz25gW2.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/admin/dashboard/guards/create/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/11.js"],"sourcesContent":["import { d as db, b as guard } from \"../../../../../../chunks/index3.js\";\nimport { fail, redirect } from \"@sveltejs/kit\";\nimport { sha256 } from \"@oslojs/crypto/sha2\";\nimport { encodeHexLowerCase } from \"@oslojs/encoding\";\nconst actions = {\n  default: async ({ request }) => {\n    const form = await request.formData();\n    const name = form.get(\"name\")?.toString().trim();\n    const phone = form.get(\"phone\")?.toString().trim();\n    const guards = await db.select().from(guard);\n    const maxNum = guards.map((g) => typeof g.guardId === \"string\" && g.guardId.startsWith(\"G\") ? parseInt(g.guardId.slice(1), 10) : 0).reduce((max, n) => n > max ? n : max, 0);\n    const nextNum = maxNum + 1;\n    const guardId = `G${nextNum.toString().padStart(3, \"0\")}`;\n    const file = form.get(\"profilePic\");\n    let profilePic = null;\n    if (file && typeof file === \"object\" && \"arrayBuffer\" in file) {\n      const buffer = Buffer.from(await file.arrayBuffer());\n      profilePic = `data:${file.type};base64,${buffer.toString(\"base64\")}`;\n    }\n    if (!name || !phone || !guardId) {\n      return fail(400, { error: \"All fields are required.\" });\n    }\n    try {\n      const plainPassword = guardId;\n      const passwordHash = encodeHexLowerCase(sha256(new TextEncoder().encode(plainPassword)));\n      await db.insert(guard).values({\n        username: guardId,\n        passwordHash,\n        name,\n        phone,\n        guardId,\n        profilePic\n      });\n      console.log(`Created guard ${guardId} with default password: ${plainPassword}`);\n      throw redirect(303, \"/admin/dashboard/guards\");\n    } catch (e) {\n      return fail(500, { error: \"Failed to create guard.\" });\n    }\n  }\n};\nexport {\n  actions\n};\n","import * as server from '../entries/pages/admin/dashboard/guards/create/_page.server.ts.js';\n\nexport const index = 11;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/admin/dashboard/guards/create/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/admin/dashboard/guards/create/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/11.B1U0kSzw.js\",\"_app/immutable/chunks/DsnmJJEf.js\",\"_app/immutable/chunks/i9DHmAX1.js\",\"_app/immutable/chunks/MgvKJ5Oe.js\",\"_app/immutable/chunks/DANlTl3y.js\",\"_app/immutable/chunks/uYRH7WDe.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}