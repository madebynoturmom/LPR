import"../chunks/DsnmJJEf.js";import"../chunks/i9DHmAX1.js";import{o as gt}from"../chunks/BQQlMUYl.js";import{p as yt,f as b,i as rt,b as p,c as wt,s as u,m as N,d as e,e as i,u as n,r,g as t,t as T}from"../chunks/MgvKJ5Oe.js";import{s as w}from"../chunks/tNEdk8z3.js";import{i as A}from"../chunks/uYRH7WDe.js";import{e as xt,i as Dt}from"../chunks/D3LgcHxc.js";import{r as F,a as M}from"../chunks/STPvjbMu.js";import{e as C}from"../chunks/DANlTl3y.js";import{s as Gt}from"../chunks/CBbLTMDG.js";import{s as st}from"../chunks/CdEA5IGF.js";import{i as It}from"../chunks/mO3J0t2N.js";import{b as Pt}from"../chunks/CSwq9K3f.js";import{p as kt}from"../chunks/BifvwZtI.js";var St=b('<div class="error"> </div>'),qt=b('<tr class="edit-row"><td colspan="3"><div class="edit-card"><form class="edit-form subpage-form"><input type="hidden" name="id"/> <label>Name<input name="name" required/></label> <label>Phone<input name="phone" required/></label> <label>Guard ID<input name="guardId" required/></label> <div style="display:flex; gap:0.5rem; margin-top:0.75rem;"><button type="submit" class="btn btn-update">Update</button> <button type="button" class="btn btn-ghost">Cancel</button></div> <!></form></div></td></tr>'),Et=b('<tr class="guard-details"><td colspan="3"><div class="resident-details" style="padding:0.75rem 0;"><div class="detail-row"><strong>Name:</strong> </div> <div class="detail-row"><strong>Phone:</strong> </div> <div class="detail-row"><strong>Guard ID:</strong> </div> <div class="detail-actions" style="margin-top:0.5rem;"><button type="button" class="edit-btn">Edit</button> <form method="POST" action="?/delete" style="display:inline"><input type="hidden" name="id"/> <button type="submit" class="delete-btn"></button></form></div></div></td></tr>'),Nt=b('<tr class="guard-summary"><td data-label="Name"> </td><td data-label="Phone"> </td><td data-label="Guard ID"> </td></tr> <!>',1),Tt=b('<table class="guard-table"><thead><tr><th>Name</th><th>Phone</th><th>Guard ID</th></tr></thead><tbody><!><!></tbody></table>'),At=b("<p>No guards found.</p>"),Ft=b('<div class="toast-wrap" role="status" aria-live="polite"><div class="toast">Guard deleted</div> <div class="toast-progress"><div class="toast-bar"></div></div></div>'),Mt=b('<div class="subpage-container"><div class="subpage-card"><div class="subpage-header"><div><h2 class="subpage-title">Manage Guards</h2></div> <div class="subpage-actions"><a href="/admin/dashboard/guards/create" class="add-guard-btn">+ Add Guard</a></div></div> <h3>Guards List</h3> <!></div></div> <!>',1);function Yt(it,B){yt(B,!1);let x=kt(B,"data",8)()?.guards??[];const W=x&&x.length>0?x:[];let o=N(null),G=N(null),L=N(null);function dt(a){if(a==null)return;const d=String(a);u(L,t(L)===d?null:d)}function ot(a){u(o,{...a}),u(G,null)}function nt(){u(o,null),u(G,null)}let H=N(!1),J=N(0);gt(()=>{try{const a=new URL(window.location.href);a.searchParams.get("deleted")==="1"&&(lt(),a.searchParams.delete("deleted"),window.history.replaceState({},"",a.pathname+a.search+a.hash))}catch{}});function lt(){u(H,!0),u(J,0);const a=3e3,d=Date.now(),l=()=>{const c=Date.now()-d;u(J,Math.min(100,Math.round(c/a*100))),c<a?requestAnimationFrame(l):setTimeout(()=>u(H,!1),120)};requestAnimationFrame(l)}async function vt(a){a.preventDefault();const d=a.target,l=new FormData(d),c=t(o)?.id;if(!(await fetch(`/admin/dashboard/guards/${c}/edit`,{method:"POST",body:l})).ok){u(G,"Failed to update guard (server may need an edit endpoint)");return}const I=x.findIndex(m=>String(m.id)===String(c));if(I!==-1){const m=Array.from(l.entries()).reduce((s,[f,v])=>(s[String(f)]=v,s),{});x[I]={...x[I],...m}}u(o,null)}It();var X=Mt(),K=rt(X),Y=e(K),ut=i(e(Y),4);{var ct=a=>{var d=Tt(),l=i(e(d)),c=e(l);{var Z=m=>{var s=qt(),f=e(s),v=e(f),_=e(v),P=e(_);F(P);var h=i(P,2),O=i(e(h));F(O),r(h);var D=i(h,2),U=i(e(D));F(U),r(D);var k=i(D,2),R=i(e(k));F(R),r(k);var g=i(k,2),S=i(e(g),2);r(g);var j=i(g,2);{var z=y=>{var q=St(),E=e(q,!0);r(q),T(()=>w(E,t(G))),p(y,q)};A(j,y=>{t(G)&&y(z)})}r(_),r(v),r(f),r(s),T(()=>{M(P,(t(o),n(()=>t(o).id))),M(O,(t(o),n(()=>t(o).name))),M(U,(t(o),n(()=>t(o).phone))),M(R,(t(o),n(()=>t(o).guardId)))}),C("click",S,nt),C("submit",_,vt),p(m,s)};A(c,m=>{t(o)&&m(Z)})}var I=i(c);xt(I,1,()=>W,Dt,(m,s)=>{var f=Nt(),v=rt(f),_=e(v),P=e(_,!0);r(_);var h=i(_),O=e(h,!0);r(h);var D=i(h),U=e(D,!0);r(D),r(v);var k=i(v,2);{var R=g=>{var S=Et(),j=e(S),z=e(j),y=e(z),q=i(e(y));r(y);var E=i(y,2),ft=i(e(E));r(E);var Q=i(E,2),_t=i(e(Q));r(Q);var $=i(Q,2),tt=e($),at=i(tt,2),V=e(at);F(V);var et=i(V,2);et.textContent="Delete",r(at),r($),r(z),r(j),r(S),T(()=>{w(q,` ${t(s),n(()=>t(s).name??"—")??""}`),w(ft,` ${t(s),n(()=>t(s).phone??"—")??""}`),w(_t,` ${t(s),n(()=>t(s).guardId??"—")??""}`),M(V,(t(s),n(()=>t(s).id)))}),C("click",tt,st(()=>ot(t(s)))),C("click",et,st(function(ht){Pt.call(this,B,ht)})),p(g,S)};A(k,g=>{t(L),t(s),n(()=>t(L)===String(t(s).id))&&g(R)})}T(()=>{w(P,(t(s),n(()=>t(s).name??"-"))),w(O,(t(s),n(()=>t(s).phone??"-"))),w(U,(t(s),n(()=>t(s).guardId??"-")))}),C("click",v,()=>dt(t(s).id)),p(m,f)}),r(l),r(d),p(a,d)},mt=a=>{var d=At();p(a,d)};A(ut,a=>{n(()=>W.length>0)?a(ct):a(mt,!1)})}r(Y),r(K);var pt=i(K,2);{var bt=a=>{var d=Ft(),l=i(e(d),2),c=e(l);r(l),r(d),T(()=>Gt(c,`width:${t(J)??""}%`)),p(a,d)};A(pt,a=>{t(H)&&a(bt)})}p(it,X),wt()}export{Yt as component};
