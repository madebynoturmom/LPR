import"../chunks/DsnmJJEf.js";import"../chunks/Dr5p_gXH.js";import{o as Te}from"../chunks/G6y-YXti.js";import{p as qe,m as w,f as p,b as W,c as b,d as De,j as f,e as r,s as i,g as e,u as n,r as l,t as A,aP as X,n as Me}from"../chunks/D6_VZFDO.js";import{s as x}from"../chunks/BDSG5-H0.js";import{i as I}from"../chunks/BdvQLAZU.js";import{e as ke,i as Fe}from"../chunks/g0qwyJPX.js";import{r as g,a as P}from"../chunks/BfIrQ_zr.js";import{s as Ee}from"../chunks/C80BVqqJ.js";import{e as q}from"../chunks/DtrBNwtL.js";import{s as Oe}from"../chunks/Dr4jViYc.js";import{b as Ae}from"../chunks/Cko499XQ.js";import{i as Ie}from"../chunks/CmAcq_e6.js";import{p as je}from"../chunks/BWorSmfV.js";var Ce=p('<div class="edit-card"><form class="edit-form subpage-form"><input type="hidden" name="id"/> <label>Plate Number<input name="plateNumber" required/></label> <label>Name<input name="name" required/></label> <label>Phone<input name="phone" required/></label> <label>Visit Time<input name="visitTime" type="datetime-local" required/></label> <label>Duration<input name="durationMinutes" type="number" required/></label> <div style="display:flex; gap:0.5rem; margin-top:0.75rem;"><button type="submit" class="btn btn-update svelte-1fxmhl">Update</button> <button type="button" class="btn btn-ghost svelte-1fxmhl">Cancel</button></div></form></div>'),Ge=p('<input class="extend-input svelte-1fxmhl" type="number" min="1"/> <button type="button" class="edit-btn svelte-1fxmhl">Apply</button> <button type="button" class="btn btn-ghost svelte-1fxmhl">Cancel</button>',1),Ve=p('<button type="button" class="edit-btn svelte-1fxmhl">Extend</button> <form method="POST" action="?/delete" style="display:inline"><input type="hidden" name="id"/> <button type="submit" class="delete-btn svelte-1fxmhl">Delete</button></form>',1),$e=p('<div class="resident-details svelte-1fxmhl"><div class="detail-row svelte-1fxmhl"><strong>Plate:</strong> </div> <div class="detail-row svelte-1fxmhl"><strong>Name:</strong> </div> <div class="detail-row svelte-1fxmhl"><strong>Phone:</strong> </div> <div class="detail-row svelte-1fxmhl"><strong>Visit:</strong> </div> <div class="detail-row svelte-1fxmhl"><strong>Duration:</strong> </div> <div class="detail-actions svelte-1fxmhl"><!></div></div>'),Le=p('<div><button class="resident-summary svelte-1fxmhl"><div class="resident-name svelte-1fxmhl"> </div> <div class="resident-house svelte-1fxmhl"> </div> <div class="chev svelte-1fxmhl"> </div></button> <!></div>'),Ue=p('<div class="resident-list svelte-1fxmhl"></div>'),Re=p("<p>No guest passes found.</p>"),ze=p('<div class="toast-wrap" role="status" aria-live="polite"><div class="toast">Guest pass deleted</div> <div class="toast-progress"><div class="toast-bar"></div></div></div>'),Be=p('<div class="subpage-container"><div class="subpage-card"><div class="subpage-header"><div><h2 class="subpage-title">Manage Guest Passes</h2></div></div> <form method="POST" action="?/create" class="vehicle-form svelte-1fxmhl"><label class="svelte-1fxmhl">Plate Number: <input name="plateNumber" required class="svelte-1fxmhl"/></label> <label class="svelte-1fxmhl">Name: <input name="name" required class="svelte-1fxmhl"/></label> <label class="svelte-1fxmhl">Phone: <input name="phone" required class="svelte-1fxmhl"/></label> <label class="svelte-1fxmhl">Visit Time: <input name="visitTime" type="datetime-local" required class="svelte-1fxmhl"/></label> <label class="svelte-1fxmhl">Duration (minutes): <input name="durationMinutes" type="number" min="1" required class="svelte-1fxmhl"/></label> <button type="submit" class="btn btn-update svelte-1fxmhl">Create Pass</button></form> <h3>Active Guest Passes</h3> <!> <!></div></div> <!>',1);function st(ie,Y){qe(Y,!1);let le=je(Y,"data",8),u=w(le()?.passes??[]),v=w(null),j=null,h=w(null),U=w(!1),R=w(0),D=w(null),M=w(30);function re(a){f(h,e(h)===a?null:a)}Te(()=>{try{const a=new URL(window.location.href);a.searchParams.get("deleted")==="1"&&(se(),a.searchParams.delete("deleted"),window.history.replaceState({},"",a.pathname+a.search+a.hash))}catch{}});function se(){f(U,!0),f(R,0);const a=3e3,s=Date.now(),o=()=>{const t=Date.now()-s;f(R,Math.min(100,Math.round(t/a*100))),t<a?requestAnimationFrame(o):setTimeout(()=>f(U,!1),120)};requestAnimationFrame(o)}function ne(a){if(!a)return"—";try{return new Date(a).toLocaleString()}catch{return String(a)}}async function oe(a){try{const s=a.id,o=new FormData;o.append("id",String(s)),o.append("minutes",String(e(M)));const t=await fetch(`/admin/dashboard/guests/${s}/extend`,{method:"POST",body:o});if(!t.ok){j="Failed to extend pass";return}let m=null;try{m=await t.json()}catch{}const d=e(u).findIndex(c=>String(c.id)===String(s));d!==-1&&(m?.pass?X(u,e(u)[d]={...e(u)[d],...m.pass}):X(u,e(u)[d].durationMinutes=(Number(e(u)[d].durationMinutes)||0)+Number(e(M)))),f(D,null)}catch{j="Failed to extend pass"}}function de(){f(v,null),j=null}async function ve(a){a.preventDefault();const s=a.target,o=new FormData(s),t=e(v)?.id;if(!(await fetch(`/admin/dashboard/guests/${t}/edit`,{method:"POST",body:o})).ok){j="Failed to update guest pass";return}const d=e(u).findIndex(c=>String(c.id)===String(t));d!==-1&&X(u,e(u)[d]={...e(u)[d],...Object.fromEntries(o)}),f(v,null)}Ie();var Z=Be(),z=W(Z),ee=r(z),te=i(r(ee),6);{var ue=a=>{var s=Ce(),o=r(s),t=r(o);g(t);var m=i(t,2),d=i(r(m));g(d),l(m);var c=i(m,2),C=i(r(c));g(C),l(c);var y=i(c,2),G=i(r(y));g(G),l(y);var S=i(y,2),V=i(r(S));g(V),l(S);var k=i(S,2),$=i(r(k));g($),l(k);var N=i(k,2),F=i(r(N),2);l(N),l(o),l(s),A(()=>{P(t,(e(v),n(()=>e(v).id))),P(d,(e(v),n(()=>e(v).plateNumber))),P(C,(e(v),n(()=>e(v).name))),P(G,(e(v),n(()=>e(v).phone))),P(V,(e(v),n(()=>e(v).visitTime))),P($,(e(v),n(()=>e(v).durationMinutes)))}),q("click",F,de),q("submit",o,ve),b(a,s)};I(te,a=>{e(v)&&a(ue)})}var me=i(te,2);{var ce=a=>{var s=Ue();ke(s,5,()=>e(u),Fe,(o,t)=>{var m=Le(),d=r(m),c=r(d),C=r(c,!0);l(c);var y=i(c,2),G=r(y,!0);l(y);var S=i(y,2),V=r(S,!0);l(S),l(d);var k=i(d,2);{var $=N=>{var F=$e(),B=r(F),he=i(r(B));l(B);var H=i(B,2),_e=i(r(H));l(H);var J=i(H,2),xe=i(r(J));l(J);var K=i(J,2),ge=i(r(K));l(K);var Q=i(K,2),ye=i(r(Q));l(Q);var ae=i(Q,2),we=r(ae);{var Pe=_=>{var E=Ge(),T=W(E);g(T);var O=i(T,2),L=i(O,2);Ae(T,()=>e(M),Ne=>f(M,Ne)),q("click",O,()=>oe(e(t))),q("click",L,()=>{f(D,null)}),b(_,E)},Se=_=>{var E=Ve(),T=W(E),O=i(T,2),L=r(O);g(L),Me(2),l(O),A(()=>P(L,(e(t),n(()=>e(t).id)))),q("click",T,()=>{f(D,String(e(t).id)),f(M,30)}),b(_,E)};I(we,_=>{e(D),e(t),n(()=>e(D)===String(e(t).id))?_(Pe):_(Se,!1)})}l(ae),l(F),A(_=>{x(he,` ${e(t),n(()=>e(t).plateNumber)??""}`),x(_e,` ${e(t),n(()=>e(t).name)??""}`),x(xe,` ${e(t),n(()=>e(t).phone)??""}`),x(ge,` ${_??""}`),x(ye,` ${e(t),n(()=>e(t).durationMinutes)??""} minutes`)},[()=>(e(t),n(()=>ne(e(t).visitTime)))]),b(N,F)};I(k,N=>{e(h),e(t),n(()=>e(h)===e(t).id)&&N($)})}l(m),A(()=>{Ee(m,1,`resident-item ${e(h),e(t),n(()=>e(h)===e(t).id?"expanded":"")??""}`,"svelte-1fxmhl"),x(C,(e(t),n(()=>e(t).name))),x(G,(e(t),n(()=>e(t).plateNumber))),x(V,(e(h),e(t),n(()=>e(h)===e(t).id?"▾":"▸")))}),q("click",d,()=>re(e(t).id)),b(o,m)}),l(s),b(a,s)},fe=a=>{var s=Re();b(a,s)};I(me,a=>{e(u),n(()=>e(u).length>0)?a(ce):a(fe,!1)})}l(ee),l(z);var be=i(z,2);{var pe=a=>{var s=ze(),o=i(r(s),2),t=r(o);l(o),l(s),A(()=>Oe(t,`width:${e(R)??""}%`)),b(a,s)};I(be,a=>{e(U)&&a(pe)})}b(ie,Z),De()}export{st as component};
