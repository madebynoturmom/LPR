import"../chunks/DsnmJJEf.js";import"../chunks/DsPuBiMm.js";import{p as H,f as _,b as w,c as I,d as s,e as r,i as K,g as e,m,r as o,t as P,s as a}from"../chunks/N5lxWZGS.js";import{s as $}from"../chunks/B135_YsI.js";import{i as O}from"../chunks/DrWauV8B.js";import{c as L}from"../chunks/DCKGlpqt.js";import{r as D}from"../chunks/BnZ110ug.js";import{e as Q}from"../chunks/Dx3h8YKD.js";import{b as J}from"../chunks/DnwoYYiD.js";import{i as U}from"../chunks/Bc0xGMnQ.js";import{g as V}from"../chunks/Ctr7oTW1.js";import{p as W}from"../chunks/DDCxn3ry.js";import{C as X}from"../chunks/Bv3Pzr92.js";var Z=_('<div class="error"> </div>'),ee=_('<div class="message"> </div>'),te=_('<div class="brand"><div class="logo">RAMS</div> <div class="title">Residence Access Management System</div></div> <div class="login-form"><h2>Reset password</h2> <!> <!> <label>New password <input type="password" autocomplete="new-password"/></label> <label>Confirm password <input type="password" autocomplete="new-password"/></label> <button class="login-btn"> </button></div>',1),ae=_('<section class="login-viewport svelte-pkniy0"><div class="login-container svelte-pkniy0"><!></div></section>');function ge(T,Y){H(Y,!1);let p=m(""),b=m(""),c=m(null),i=m(null),v=m(!1);const j=V(W).params.token;async function q(){if(a(c,null),a(i,null),!e(p)){a(i,"Please enter a new password");return}if(e(p)!==e(b)){a(i,"Passwords do not match");return}a(v,!0);try{const n=new FormData;n.append("token",j??""),n.append("password",e(p));const f=await fetch("/login/reset",{method:"POST",body:n,credentials:"same-origin"}),d=await f.text().catch(()=>null);let u=null;if(d)try{u=JSON.parse(d)}catch{}if(!f.ok){a(i,u?.error||d||"Failed to reset password");return}a(c,u?.message||d||"Password reset. You can now login.")}catch(n){a(i,n?.message||"Network error")}finally{a(v,!1)}}U();var h=ae(),C=s(h),z=s(C);L(z,()=>X,(n,f)=>{f(n,{className:"login-section",padding:"2.25rem",children:(d,u)=>{var y=te(),N=r(K(y),2),S=r(s(N),2);{var B=t=>{var l=Z(),R=s(l,!0);o(l),P(()=>$(R,e(i))),w(t,l)};O(S,t=>{e(i)&&t(B)})}var A=r(S,2);{var E=t=>{var l=ee(),R=s(l,!0);o(l),P(()=>$(R,e(c))),w(t,l)};O(A,t=>{e(c)&&t(E)})}var k=r(A,2),F=r(s(k));D(F),o(k);var x=r(k,2),M=r(s(x));D(M),o(x);var g=r(x,2),G=s(g,!0);o(g),o(N),P(()=>{g.disabled=e(v),$(G,e(v)?"Resetting...":"Reset password")}),J(F,()=>e(p),t=>a(p,t)),J(M,()=>e(b),t=>a(b,t)),Q("click",g,q),w(d,y)},$$slots:{default:!0}})}),o(C),o(h),w(T,h),I()}export{ge as component};
