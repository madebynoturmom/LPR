import"../chunks/DsnmJJEf.js";import"../chunks/DsPuBiMm.js";import{p as oe,l as ie,a as le,f as w,e as l,i as ve,t as u,g as s,b as h,c as de,m as d,d as o,s as r,r as i}from"../chunks/N5lxWZGS.js";import{s as S}from"../chunks/B135_YsI.js";import{i as U}from"../chunks/DrWauV8B.js";import{r as $,a as ne,s as pe}from"../chunks/BnZ110ug.js";import{e as G}from"../chunks/Dx3h8YKD.js";import{b as z}from"../chunks/DnwoYYiD.js";import{p as E}from"../chunks/CdEA5IGF.js";import{i as ce}from"../chunks/Bc0xGMnQ.js";import{s as fe,a as me}from"../chunks/CkJi4ZpE.js";import{p as ue}from"../chunks/DDCxn3ry.js";import{i as he}from"../chunks/WNbVgFxQ.js";var we=w('<img alt="Profile preview" class="profile-pic-preview svelte-7r8vh3"/>'),_e=w('<div class="profile-placeholder-large"> </div>'),ge=w('<div class="message svelte-7r8vh3"> </div>'),be=w('<div class="message svelte-7r8vh3"> </div>'),Pe=w('<a href="/guard/dashboard" class="back-btn svelte-7r8vh3">&larr; Back to Dashboard</a> <div class="profile-card move-up svelte-7r8vh3"><h1>Account Settings</h1> <div class="profile-forms-row svelte-7r8vh3"><div class="profile-settings-col svelte-7r8vh3"><form class="profile-form svelte-7r8vh3" enctype="multipart/form-data"><div class="profile-pic-section"><!> <label for="profilePicture" class="upload-label svelte-7r8vh3"><span>Change Photo</span> <input id="profilePicture" name="profilePicture" type="file" accept="image/*" class="svelte-7r8vh3"/></label></div> <div class="form-grid svelte-7r8vh3"><div class="form-row svelte-7r8vh3"><label for="username">Username</label> <input id="username" name="username" type="text" readonly=""/></div></div> <button class="save-btn svelte-7r8vh3" type="submit">Save Changes</button> <!></form></div> <div class="password-col svelte-7r8vh3"><form class="password-form" autocomplete="off"><h2>Change Password</h2> <div class="form-row svelte-7r8vh3"><label for="currentPassword">Current Password</label> <input id="currentPassword" type="password" required autocomplete="current-password"/></div> <div class="form-row svelte-7r8vh3"><label for="newPassword">New Password</label> <input id="newPassword" type="password" required autocomplete="new-password"/></div> <button class="save-btn password-btn svelte-7r8vh3" type="submit">Update Password</button> <!></form></div></div></div>',1);function Ae(H,J){oe(J,!1);const p=()=>me(ue,"$page",K),[K,Q]=fe();let _=d(null),g=d(""),c=d(""),f=d(""),m=d(""),n=d(""),b=d("G");function V(a){const e=a.target;if(e.files&&e.files[0]){const t=new FileReader;t.onload=v=>{r(_,v.target?.result)},t.readAsDataURL(e.files[0])}}async function W(a){a.preventDefault();const e=a.target,t=new FormData(e);try{const v=await fetch("?/updateProfile",{method:"POST",body:t}),M=await v.json().catch(()=>null);v.ok?(r(m,M?.message||"Profile updated"),await he("/guard/dashboard")):r(m,M?.error||"Failed to update profile")}catch(v){console.error(v),r(m,"Network error")}}async function X(a){if(a.preventDefault(),!s(c)||!s(f)){r(n,"Please fill both fields");return}const e=new FormData;e.append("currentPassword",s(c)),e.append("newPassword",s(f));try{const t=await fetch("?/changePassword",{method:"POST",body:e}),v=await t.json().catch(()=>null);t.ok?(r(n,v?.message||"Password updated"),r(c,""),r(f,"")):r(n,v?.error||"Failed to update password")}catch(t){console.error(t),r(n,"Network error")}}ie(()=>(p(),s(g)),()=>{if(p().data.user){r(_,p().data.user.profilePic||null),r(g,p().data.user.username||"");const a=p().data.user.name||s(g)||"G",e=String(a).trim().split(/\s+/).filter(Boolean);e.length===0?r(b,"G"):e.length===1?r(b,e[0].slice(0,2).toUpperCase()):r(b,(e[0][0]+e[e.length-1][0]).toUpperCase())}}),le(),ce();var N=Pe(),j=l(ve(N),2),q=l(o(j),2),P=o(q),y=o(P),D=o(y),A=o(D);{var Y=a=>{var e=we();u(()=>pe(e,"src",s(_))),h(a,e)},Z=a=>{var e=_e(),t=o(e,!0);i(e),u(()=>S(t,s(b))),h(a,e)};U(A,a=>{s(_)?a(Y):a(Z,!1)})}var B=l(A,2),ee=l(o(B),2);i(B),i(D);var k=l(D,2),O=o(k),R=l(o(O),2);$(R),i(O),i(k);var ae=l(k,4);{var re=a=>{var e=ge(),t=o(e,!0);i(e),u(()=>S(t,s(m))),h(a,e)};U(ae,a=>{s(m)&&a(re)})}i(y),i(P);var T=l(P,2),C=o(T),x=l(o(C),2),I=l(o(x),2);$(I),i(x);var F=l(x,2),L=l(o(F),2);$(L),i(F);var se=l(F,4);{var te=a=>{var e=be(),t=o(e,!0);i(e),u(()=>S(t,s(n))),h(a,e)};U(se,a=>{s(n)&&a(te)})}i(C),i(T),i(q),i(j),u(()=>ne(R,s(g))),G("change",ee,V),G("submit",y,E(W)),z(I,()=>s(c),a=>r(c,a)),z(L,()=>s(f),a=>r(f,a)),G("submit",C,E(X)),h(H,N),de(),Q()}export{Ae as component};
