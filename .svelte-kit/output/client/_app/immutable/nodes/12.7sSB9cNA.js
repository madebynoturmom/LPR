import"../chunks/DsnmJJEf.js";import"../chunks/i9DHmAX1.js";import{o as Tt}from"../chunks/BQQlMUYl.js";import{p as qt,m as w,f,i as W,b as p,c as Dt,s as b,d as n,e as i,g as t,u as o,r,t as A,h as X,n as Mt}from"../chunks/MgvKJ5Oe.js";import{s as g}from"../chunks/tNEdk8z3.js";import{i as I}from"../chunks/uYRH7WDe.js";import{e as kt,i as Ft}from"../chunks/D3LgcHxc.js";import{r as y,a as P}from"../chunks/STPvjbMu.js";import{s as Et}from"../chunks/DbZgNqix.js";import{e as q}from"../chunks/DANlTl3y.js";import{s as Ot}from"../chunks/CBbLTMDG.js";import{b as At}from"../chunks/5UxS6Hio.js";import{i as It}from"../chunks/mO3J0t2N.js";import{p as Ct}from"../chunks/BifvwZtI.js";var Gt=f('<div class="edit-card"><form class="edit-form subpage-form"><input type="hidden" name="id"/> <label>Plate Number<input name="plateNumber" required/></label> <label>Name<input name="name" required/></label> <label>Phone<input name="phone" required/></label> <label>Visit Time<input name="visitTime" type="datetime-local" required/></label> <label>Duration<input name="durationMinutes" type="number" required/></label> <div style="display:flex; gap:0.5rem; margin-top:0.75rem;"><button type="submit" class="btn btn-update">Update</button> <button type="button" class="btn btn-ghost">Cancel</button></div></form></div>'),Vt=f('<input class="extend-input" type="number" min="1"/> <button type="button" class="edit-btn">Apply</button> <button type="button" class="btn btn-ghost">Cancel</button>',1),$t=f('<button type="button" class="edit-btn">Extend</button> <form method="POST" action="?/delete" style="display:inline"><input type="hidden" name="id"/> <button type="submit" class="delete-btn">Delete</button></form>',1),jt=f('<div class="resident-details"><div class="detail-row"><strong>Plate:</strong> </div> <div class="detail-row"><strong>Name:</strong> </div> <div class="detail-row"><strong>Phone:</strong> </div> <div class="detail-row"><strong>Visit:</strong> </div> <div class="detail-row"><strong>Duration:</strong> </div> <div class="detail-actions"><!></div></div>'),Lt=f('<div><button class="resident-summary"><div class="resident-name"> </div> <div class="resident-house"> </div> <div class="chev"> </div></button> <!></div>'),Ut=f('<div class="resident-list"></div>'),Rt=f("<p>No guest passes found.</p>"),zt=f('<div class="toast-wrap" role="status" aria-live="polite"><div class="toast">Guest pass deleted</div> <div class="toast-progress"><div class="toast-bar"></div></div></div>'),Bt=f('<div class="subpage-container"><div class="subpage-card"><div class="subpage-header"><div><h2 class="subpage-title">Manage Guest Passes</h2></div></div> <form method="POST" action="?/create" class="vehicle-form"><label>Plate Number: <input name="plateNumber" required/></label> <label>Name: <input name="name" required/></label> <label>Phone: <input name="phone" required/></label> <label>Visit Time: <input name="visitTime" type="datetime-local" required/></label> <label>Duration (minutes): <input name="durationMinutes" type="number" min="1" required/></label> <button type="submit" class="btn btn-update">Create Pass</button></form> <h3>Active Guest Passes</h3> <!> <!></div></div> <!>',1);function se(it,Y){qt(Y,!1);let rt=Ct(Y,"data",8),v=w(rt()?.passes??[]),u=w(null),C=null,_=w(null),U=w(!1),R=w(0),D=w(null),M=w(30);function nt(a){b(_,t(_)===a?null:a)}Tt(()=>{try{const a=new URL(window.location.href);a.searchParams.get("deleted")==="1"&&(st(),a.searchParams.delete("deleted"),window.history.replaceState({},"",a.pathname+a.search+a.hash))}catch{}});function st(){b(U,!0),b(R,0);const a=3e3,s=Date.now(),d=()=>{const e=Date.now()-s;b(R,Math.min(100,Math.round(e/a*100))),e<a?requestAnimationFrame(d):setTimeout(()=>b(U,!1),120)};requestAnimationFrame(d)}function ot(a){if(!a)return"—";try{return new Date(a).toLocaleString()}catch{return String(a)}}async function dt(a){try{const s=a.id,d=new FormData;d.append("id",String(s)),d.append("minutes",String(t(M)));const e=await fetch(`/admin/dashboard/guests/${s}/extend`,{method:"POST",body:d});if(!e.ok){C="Failed to extend pass";return}let m=null;try{m=await e.json()}catch{}const l=t(v).findIndex(c=>String(c.id)===String(s));l!==-1&&(m?.pass?X(v,t(v)[l]={...t(v)[l],...m.pass}):X(v,t(v)[l].durationMinutes=(Number(t(v)[l].durationMinutes)||0)+Number(t(M)))),b(D,null)}catch{C="Failed to extend pass"}}function lt(){b(u,null),C=null}async function ut(a){a.preventDefault();const s=a.target,d=new FormData(s),e=t(u)?.id;if(!(await fetch(`/admin/dashboard/guests/${e}/edit`,{method:"POST",body:d})).ok){C="Failed to update guest pass";return}const l=t(v).findIndex(c=>String(c.id)===String(e));l!==-1&&X(v,t(v)[l]={...t(v)[l],...Object.fromEntries(d)}),b(u,null)}It();var Z=Bt(),z=W(Z),tt=n(z),et=i(n(tt),6);{var vt=a=>{var s=Gt(),d=n(s),e=n(d);y(e);var m=i(e,2),l=i(n(m));y(l),r(m);var c=i(m,2),G=i(n(c));y(G),r(c);var x=i(c,2),V=i(n(x));y(V),r(x);var S=i(x,2),$=i(n(S));y($),r(S);var k=i(S,2),j=i(n(k));y(j),r(k);var N=i(k,2),F=i(n(N),2);r(N),r(d),r(s),A(()=>{P(e,(t(u),o(()=>t(u).id))),P(l,(t(u),o(()=>t(u).plateNumber))),P(G,(t(u),o(()=>t(u).name))),P(V,(t(u),o(()=>t(u).phone))),P($,(t(u),o(()=>t(u).visitTime))),P(j,(t(u),o(()=>t(u).durationMinutes)))}),q("click",F,lt),q("submit",d,ut),p(a,s)};I(et,a=>{t(u)&&a(vt)})}var mt=i(et,2);{var ct=a=>{var s=Ut();kt(s,5,()=>t(v),Ft,(d,e)=>{var m=Lt(),l=n(m),c=n(l),G=n(c,!0);r(c);var x=i(c,2),V=n(x,!0);r(x);var S=i(x,2),$=n(S,!0);r(S),r(l);var k=i(l,2);{var j=N=>{var F=jt(),B=n(F),_t=i(n(B));r(B);var H=i(B,2),ht=i(n(H));r(H);var J=i(H,2),gt=i(n(J));r(J);var K=i(J,2),yt=i(n(K));r(K);var Q=i(K,2),xt=i(n(Q));r(Q);var at=i(Q,2),wt=n(at);{var Pt=h=>{var E=Vt(),T=W(E);y(T);var O=i(T,2),L=i(O,2);At(T,()=>t(M),Nt=>b(M,Nt)),q("click",O,()=>dt(t(e))),q("click",L,()=>{b(D,null)}),p(h,E)},St=h=>{var E=$t(),T=W(E),O=i(T,2),L=n(O);y(L),Mt(2),r(O),A(()=>P(L,(t(e),o(()=>t(e).id)))),q("click",T,()=>{b(D,String(t(e).id)),b(M,30)}),p(h,E)};I(wt,h=>{t(D),t(e),o(()=>t(D)===String(t(e).id))?h(Pt):h(St,!1)})}r(at),r(F),A(h=>{g(_t,` ${t(e),o(()=>t(e).plateNumber)??""}`),g(ht,` ${t(e),o(()=>t(e).name)??""}`),g(gt,` ${t(e),o(()=>t(e).phone)??""}`),g(yt,` ${h??""}`),g(xt,` ${t(e),o(()=>t(e).durationMinutes)??""} minutes`)},[()=>(t(e),o(()=>ot(t(e).visitTime)))]),p(N,F)};I(k,N=>{t(_),t(e),o(()=>t(_)===t(e).id)&&N(j)})}r(m),A(()=>{Et(m,1,`resident-item ${t(_),t(e),o(()=>t(_)===t(e).id?"expanded":"")??""}`),g(G,(t(e),o(()=>t(e).name))),g(V,(t(e),o(()=>t(e).plateNumber))),g($,(t(_),t(e),o(()=>t(_)===t(e).id?"▾":"▸")))}),q("click",l,()=>nt(t(e).id)),p(d,m)}),r(s),p(a,s)},bt=a=>{var s=Rt();p(a,s)};I(mt,a=>{t(v),o(()=>t(v).length>0)?a(ct):a(bt,!1)})}r(tt),r(z);var pt=i(z,2);{var ft=a=>{var s=zt(),d=i(n(s),2),e=n(d);r(d),r(s),A(()=>Ot(e,`width:${t(R)??""}%`)),p(a,s)};I(pt,a=>{t(U)&&a(ft)})}p(it,Z),Dt()}export{se as component};
